<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Diagnostic Test</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 20px; background: #000; color: #fff; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; border-radius: 8px; }
        .pass { background: #004400; border-color: #00ff00; }
        .fail { background: #440000; border-color: #ff0000; }
        .pending { background: #444400; border-color: #ffff00; }
        pre { background: #222; padding: 10px; border-radius: 4px; overflow-x: auto; }
        audio { width: 100%; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîß Mobile Diagnostic Test</h1>
    <div id="diagnostics"></div>
    
    <script>
        const diagnostics = document.getElementById('diagnostics');
        
        function addTest(name, status, details) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <h3>${status === 'pass' ? '‚úÖ' : status === 'fail' ? '‚ùå' : '‚è≥'} ${name}</h3>
                <pre>${details}</pre>
            `;
            diagnostics.appendChild(div);
        }
        
        // Test 1: Current Location
        addTest('Current Location', 'pass', `
URL: ${window.location.href}
Path: ${window.location.pathname}
Protocol: ${window.location.protocol}
Host: ${window.location.host}`);
        
        // Test 2: User Agent
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        addTest('Device Detection', isIOS ? 'pass' : 'pending', `
User Agent: ${navigator.userAgent}
Is iOS: ${isIOS}
Screen: ${screen.width}x${screen.height}
Viewport: ${window.innerWidth}x${window.innerHeight}`);
        
        // Test 3: Load tracks.js
        const script1 = document.createElement('script');
        script1.src = '../tracks.js';
        script1.onload = () => {
            const tracksLoaded = typeof TRACKS !== 'undefined';
            addTest('Tracks Loading', tracksLoaded ? 'pass' : 'fail', `
Script URL: ${script1.src}
TRACKS defined: ${tracksLoaded}
Tracks count: ${tracksLoaded ? TRACKS.length : 'N/A'}
${tracksLoaded ? 'First track: ' + JSON.stringify(TRACKS[0], null, 2) : ''}`);
            
            if (tracksLoaded && TRACKS.length > 0) {
                // Test 4: Audio Path Resolution
                const firstTrack = TRACKS[0];
                const audioPath = '../' + firstTrack.src;
                addTest('Audio Path Test', 'pending', `
Original path: ${firstTrack.src}
Mobile path: ${audioPath}
Full URL: ${new URL(audioPath, window.location.href).href}`);
                
                // Test 5: Audio Element
                const audio = document.createElement('audio');
                audio.controls = true;
                audio.src = audioPath;
                audio.onloadedmetadata = () => {
                    addTest('Audio Loading', 'pass', `
Audio source: ${audio.src}
Duration: ${audio.duration}s
Ready state: ${audio.readyState}`);
                };
                audio.onerror = (e) => {
                    addTest('Audio Loading', 'fail', `
Audio source: ${audio.src}
Error: ${audio.error ? audio.error.message : 'Unknown error'}
Network state: ${audio.networkState}
Ready state: ${audio.readyState}`);
                };
                
                const audioDiv = document.createElement('div');
                audioDiv.className = 'test pending';
                audioDiv.innerHTML = '<h3>üéµ Audio Test</h3>';
                audioDiv.appendChild(audio);
                diagnostics.appendChild(audioDiv);
            }
        };
        script1.onerror = () => {
            addTest('Tracks Loading', 'fail', `
Script URL: ${script1.src}
Error: Failed to load tracks.js
This suggests the mobile directory structure is not correct`);
        };
        document.head.appendChild(script1);
        
        // Test 6: Other scripts
        const testScripts = ['../main.js', 'ios-player.js', 'ios-bridge.js'];
        testScripts.forEach((src, index) => {
            const script = document.createElement('script');
            script.src = src;
            script.onload = () => {
                addTest(`Script ${index + 1}: ${src}`, 'pass', `Loaded successfully`);
            };
            script.onerror = () => {
                addTest(`Script ${index + 1}: ${src}`, 'fail', `Failed to load`);
            };
            document.head.appendChild(script);
        });
        
        // Test 7: Network connectivity
        fetch('../tracks.js')
            .then(response => {
                addTest('Network Test', response.ok ? 'pass' : 'fail', `
Status: ${response.status} ${response.statusText}
URL: ${response.url}
Type: ${response.type}`);
            })
            .catch(error => {
                addTest('Network Test', 'fail', `
Error: ${error.message}
This suggests a network or path resolution issue`);
            });
    </script>
</body>
</html>
